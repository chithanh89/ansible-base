---
# tasks file for mongodb
- name: Ensure hostname set
  hostname: name={{ inventory_hostname }}
  when: not inventory_hostname is match('(\d{1,3}\.){3}\d{1,3}')

#- name: Ensure hostname is in /etc/hosts
#  lineinfile:
#    dest: /etc/hosts
#    regexp: "^{{ ansible_default_ipv4.address }}.+$"
#    line: "{{ ansible_default_ipv4.address }} {{ ansible_fqdn }} {{ ansible_hostname }}"

- name: Add IP address of all hosts to all hosts
  lineinfile:
    dest: /etc/hosts
    regexp: '.*{{ item }}$'
    line: "{{ hostvars[item].ansible_host }} {{item}}"
    state: present
  when: hostvars[item].ansible_host is defined
  with_items: "{{ groups.all }}"

#- name: restart machine
#  reboot:
#    reboot_timeout: 600
#  async: 0
#  poll: 0
#  ignore_errors: True

#- name: Waiting for server to come back up
#  local_action: wait_for host="{{ inventory_hostname }}" port=22 state=started
